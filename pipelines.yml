template: true
valuesFilePath: ./values.yml

resources:
  # # Build info of first build to bundle
  # - name: {{ .Values.build.name1 }}
  #   type: BuildInfo
  #   configuration:
  #     sourceArtifactory: {{ .Values.artifactory }}
  #     buildName: {{ .Values.build.name1 }}
  #     buildNumber: {{ .Values.build.number1 }}
 
  # # Build info of second build to bundle
  # - name: appl_promoted_build_info_for_edge
  #   type: BuildInfo
  #   configuration:
  #     sourceArtifactory: myArtifactory
  #     buildName: quickstart_docker_build
  #     buildNumber: 1
 
  # Release Bundle
  - name: {{ .Values.pipelines.name }}
    type: ReleaseBundle
    configuration:
      sourceDistribution: {{ .Values.distribution }}
      name: {{ .Values.pipelines.name }}
      version: beta
 
  # # Signed version of the same release bundle
  # - name: signed_bundle
  #   type: ReleaseBundle
  #   configuration:
  #     sourceDistribution: myDist
  #     name: demo_rb
  #     version: v1.0.0
 
  # # Distribution rules
  # - name: distribution_rules
  #   type: DistributionRule
  #   configuration:
  #     sourceDistribution: myDist
  #     serviceName: "*"
  #     siteName: "*"
  #     cityName: "*"
  #     countryCodes:
  #       - "JP"
  #       - "GB"


pipelines:
  - name: {{ .Values.pipelines.name }}
    steps:
      - name: create_release_bundle
        type: CreateReleaseBundle
        configuration:
          releaseBundleName: {{ .Values.pipelines.name }}
          releaseBundleVersion: beta-${run_number}
          dryRun: true
          # sign: false
          description: {{ .Values.pipelines.name }}
          inputResources:
            - name: quickstart_go_build
            # - name: appl_promoted_build_info_for_edge
          outputResources:
            - name: {{ .Values.pipelines.name }}
          # releaseNotes:
          #   syntax: markdown
          #   content: |
          #     ## Heading
          #       * Bullet
          #       * Points
             
      # - name: sign
      #   type: SignReleaseBundle
      #   configuration:
      #     inputResources:
      #       - name: release_bundle
      #     outputResources:
      #       - name: signed_bundle
 
      # - name: distribute
      #   type: DistributeReleaseBundle
      #   configuration:
      #     dryRun: false
      #     inputResources:
      #       - name: signed_bundle
      #       - name: distribution_rules
